Project "HanbaiApp" {
  database_type: "PostgreSQL"
}

Table usuario{
  id_usuario UUID [pk , not null]
  nombre varchar(100) [not null]
  correo varchar(100) [not null , unique]
  password_hash varchar(255) [not null]
  dni varchar(20) [not null , unique]
  creadoEn timestamp [default: 'now()']
  actualizadoEn timestamp [default: 'now()']

  // Relacion 1:1 con "rol"
  rol_id UUID [not null , ref: > rol.id_rol]
}

Table rol{
  id_rol UUID [pk , not null]
  nombre varchar(100) [not null , unique]
  descripcion TEXT
  creadoEn timestamp [default: 'now()']
  actualizadoEn timestamp [default: 'now()']
}

Table venta {
  id_venta UUID [pk , not null]
  subtotal numeric(14 , 4) [not null]

  estado_venta_id UUID [not null , ref: > estado_venta.id_estado_venta]
  usuario_id UUID [not null , ref: > usuario.id_usuario]
}

Table cargo {
  id_cargo UUID [pk , not null]
  nombre varchar(100) [not null ]
  porcentaje_total numeric(5 , 2) [not null]
  descripcion TEXT
  creadoEn timestamp [default: 'now()']
  actualizadoEn timestamp [default: 'now()']
}

Table estado_venta {
  id_estado_venta UUID [pk , not null]
  nombre varchar(100) [not null]
  descripcion TEXT

  indexes {
    (id_estado_venta , nombre) [unique , name: "EstadoVenta_UQ"]
  }
}

Table producto {
  id_producto UUID [pk , not null]
  nombre varchar(255) [not null , unique]
  descripcion TEXT
  precio numeric(8 , 2) [not null]
  stock integer [not null]
  descuento_producto numeric(5 , 2)

  categoria_id UUID [ref: > categoria.id_categoria]

  indexes {
    (id_producto , nombre) [unique , name: "Producto_UQ"]
  }
}

Table categoria {
  id_categoria UUID [pk , not null]
  nombre varchar(100) [not null , unique]
  descuento_categoria numeric(5 , 2) [default: '0']
  descripcion TEXT

  indexes {
    (id_categoria , nombre) [unique , name: "Categoria_UQ"]
  }
}

Table comprobante {
  id_comprobante UUID [pk , not null]
  venta_id UUID [not null , ref: > venta.id_venta , unique]

  total numeric(14 , 5) [not null]
  fecha_venta timestamp [default: 'now()']
  lugar_venta varchar(100)

  indexes {
    (id_comprobante , venta_id) [unique , name: "Comprobante_UQ"]
  }
}

Table comprobante_producto {
  comprobante_id UUID [pk , not null , ref: > comprobante.id_comprobante]
  producto_id UUID [pk , not null , ref: > producto.id_producto]
}

Table comprobante_cargo {
  comprobante_id UUID [pk , not null , ref: > comprobante.id_comprobante]
  cargo_id UUID [pk , not null , ref: > cargo.id_cargo]
}

Table reporte {
  id_reporte UUID [pk , not null]
  nombre varchar(100) [not null, unique]
  formato_archivo varchar(10) [not null]
  periodo_persistencia timestamp [default: "now() + interval '1 day'"]
  url varchar(200) [not null]

  formato_reporte_id UUID [not null , ref: > formato_reporte.id_formato_reporte]

  indexes {
    (id_reporte , nombre) [unique , name: "Reporte_UQ"]
  }
}

Table formato_reporte {
  id_formato_reporte UUID [pk , not null]
  nombre varchar(100) [not null , unique]
  creado_en timestamp [default: 'now()']
  actualizado_en timestamp [default: 'now()']

  indexes {
    (id_formato_reporte , nombre) [unique , name: "FormatoReporte_UQ"]
  }
}

Table rol_reporte {
  reporte_id UUID [pk , not null , ref: > reporte.id_reporte]
  rol_id UUID [PK , not null , ref: > rol.id_rol]

  asignado_en timestamp [default: 'now()']
}